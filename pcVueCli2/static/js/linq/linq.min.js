Enumerable=function(){var Enumerable=function(getEnumerator){this.GetEnumerator=getEnumerator};Enumerable.Choice=function(){var args=arguments[0]instanceof Array?arguments[0]:arguments;return new Enumerable((function(){return new IEnumerator(Functions.Blank,(function(){return this.Yield(args[Math.floor(Math.random()*args.length)])}),Functions.Blank)}))},Enumerable.Cycle=function(){var args=arguments[0]instanceof Array?arguments[0]:arguments;return new Enumerable((function(){var index=0;return new IEnumerator(Functions.Blank,(function(){return index>=args.length&&(index=0),this.Yield(args[index++])}),Functions.Blank)}))},Enumerable.Empty=function(){return new Enumerable((function(){return new IEnumerator(Functions.Blank,(function(){return!1}),Functions.Blank)}))},Enumerable.From=function(obj){if(null==obj)return Enumerable.Empty();if(obj instanceof Enumerable)return obj;if(typeof obj==Types.Number||typeof obj==Types.Boolean)return Enumerable.Repeat(obj,1);if(typeof obj==Types.String)return new Enumerable((function(){var index=0;return new IEnumerator(Functions.Blank,(function(){return index<obj.length&&this.Yield(obj.charAt(index++))}),Functions.Blank)}));if(typeof obj!=Types.Function){if(typeof obj.length==Types.Number)return new ArrayEnumerable(obj);if(!(obj instanceof Object)&&Utils.IsIEnumerable(obj))return new Enumerable((function(){var isFirst=!0,enumerator;return new IEnumerator((function(){enumerator=new Enumerator(obj)}),(function(){return isFirst?isFirst=!1:enumerator.moveNext(),!enumerator.atEnd()&&this.Yield(enumerator.item())}),Functions.Blank)}))}return new Enumerable((function(){var array=[],index=0;return new IEnumerator((function(){for(var key in obj)obj[key]instanceof Function||array.push({Key:key,Value:obj[key]})}),(function(){return index<array.length&&this.Yield(array[index++])}),Functions.Blank)}))},Enumerable.Return=function(element){return Enumerable.Repeat(element,1)},Enumerable.Matches=function(input,pattern,flags){return null==flags&&(flags=""),pattern instanceof RegExp&&(flags+=pattern.ignoreCase?"i":"",flags+=pattern.multiline?"m":"",pattern=pattern.source),-1===flags.indexOf("g")&&(flags+="g"),new Enumerable((function(){var regex;return new IEnumerator((function(){regex=new RegExp(pattern,flags)}),(function(){var match=regex.exec(input);return!!match&&this.Yield(match)}),Functions.Blank)}))},Enumerable.Range=function(start,count,step){return null==step&&(step=1),Enumerable.ToInfinity(start,step).Take(count)},Enumerable.RangeDown=function(start,count,step){return null==step&&(step=1),Enumerable.ToNegativeInfinity(start,step).Take(count)},Enumerable.RangeTo=function(start,to,step){return null==step&&(step=1),start<to?Enumerable.ToInfinity(start,step).TakeWhile((function(i){return i<=to})):Enumerable.ToNegativeInfinity(start,step).TakeWhile((function(i){return i>=to}))},Enumerable.Repeat=function(obj,num){return null!=num?Enumerable.Repeat(obj).Take(num):new Enumerable((function(){return new IEnumerator(Functions.Blank,(function(){return this.Yield(obj)}),Functions.Blank)}))},Enumerable.RepeatWithFinalize=function(initializer,finalizer){return initializer=Utils.CreateLambda(initializer),finalizer=Utils.CreateLambda(finalizer),new Enumerable((function(){var element;return new IEnumerator((function(){element=initializer()}),(function(){return this.Yield(element)}),(function(){null!=element&&(finalizer(element),element=null)}))}))},Enumerable.Generate=function(func,count){return null!=count?Enumerable.Generate(func).Take(count):(func=Utils.CreateLambda(func),new Enumerable((function(){return new IEnumerator(Functions.Blank,(function(){return this.Yield(func())}),Functions.Blank)})))},Enumerable.ToInfinity=function(start,step){return null==start&&(start=0),null==step&&(step=1),new Enumerable((function(){var value;return new IEnumerator((function(){value=start-step}),(function(){return this.Yield(value+=step)}),Functions.Blank)}))},Enumerable.ToNegativeInfinity=function(start,step){return null==start&&(start=0),null==step&&(step=1),new Enumerable((function(){var value;return new IEnumerator((function(){value=start+step}),(function(){return this.Yield(value-=step)}),Functions.Blank)}))},Enumerable.Unfold=function(seed,func){return func=Utils.CreateLambda(func),new Enumerable((function(){var isFirst=!0,value;return new IEnumerator(Functions.Blank,(function(){return isFirst?(isFirst=!1,value=seed,this.Yield(value)):(value=func(value),this.Yield(value))}),Functions.Blank)}))},Enumerable.prototype={CascadeBreadthFirst:function(func,resultSelector){var source=this;return func=Utils.CreateLambda(func),resultSelector=Utils.CreateLambda(resultSelector),new Enumerable((function(){var enumerator,nestLevel=0,buffer=[];return new IEnumerator((function(){enumerator=source.GetEnumerator()}),(function(){for(;;){if(enumerator.MoveNext())return buffer.push(enumerator.Current()),this.Yield(resultSelector(enumerator.Current(),nestLevel));var next=Enumerable.From(buffer).SelectMany((function(x){return func(x)}));if(!next.Any())return!1;nestLevel++,buffer=[],Utils.Dispose(enumerator),enumerator=next.GetEnumerator()}}),(function(){Utils.Dispose(enumerator)}))}))},CascadeDepthFirst:function(func,resultSelector){var source=this;return func=Utils.CreateLambda(func),resultSelector=Utils.CreateLambda(resultSelector),new Enumerable((function(){var enumeratorStack=[],enumerator;return new IEnumerator((function(){enumerator=source.GetEnumerator()}),(function(){for(;;){if(enumerator.MoveNext()){var value=resultSelector(enumerator.Current(),enumeratorStack.length);return enumeratorStack.push(enumerator),enumerator=Enumerable.From(func(enumerator.Current())).GetEnumerator(),this.Yield(value)}if(enumeratorStack.length<=0)return!1;Utils.Dispose(enumerator),enumerator=enumeratorStack.pop()}}),(function(){try{Utils.Dispose(enumerator)}finally{Enumerable.From(enumeratorStack).ForEach((function(s){s.Dispose()}))}}))}))},Flatten:function(){var source=this;return new Enumerable((function(){var enumerator,middleEnumerator=null;return new IEnumerator((function(){enumerator=source.GetEnumerator()}),(function(){for(;;){if(null!=middleEnumerator){if(middleEnumerator.MoveNext())return this.Yield(middleEnumerator.Current());middleEnumerator=null}if(enumerator.MoveNext()){if(enumerator.Current()instanceof Array){Utils.Dispose(middleEnumerator),middleEnumerator=Enumerable.From(enumerator.Current()).SelectMany(Functions.Identity).Flatten().GetEnumerator();continue}return this.Yield(enumerator.Current())}return!1}}),(function(){try{Utils.Dispose(enumerator)}finally{Utils.Dispose(middleEnumerator)}}))}))},Pairwise:function(selector){var source=this;return selector=Utils.CreateLambda(selector),new Enumerable((function(){var enumerator;return new IEnumerator((function(){(enumerator=source.GetEnumerator()).MoveNext()}),(function(){var prev=enumerator.Current();return!!enumerator.MoveNext()&&this.Yield(selector(prev,enumerator.Current()))}),(function(){Utils.Dispose(enumerator)}))}))},Scan:function(seed,func,resultSelector){if(null!=resultSelector)return this.Scan(seed,func).Select(resultSelector);var isUseSeed;null==func?(func=Utils.CreateLambda(seed),isUseSeed=!1):(func=Utils.CreateLambda(func),isUseSeed=!0);var source=this;return new Enumerable((function(){var enumerator,value,isFirst=!0;return new IEnumerator((function(){enumerator=source.GetEnumerator()}),(function(){if(isFirst){if(isFirst=!1,isUseSeed)return this.Yield(value=seed);if(enumerator.MoveNext())return this.Yield(value=enumerator.Current())}return!!enumerator.MoveNext()&&this.Yield(value=func(value,enumerator.Current()))}),(function(){Utils.Dispose(enumerator)}))}))},Select:function(selector){var source=this;return selector=Utils.CreateLambda(selector),new Enumerable((function(){var enumerator,index=0;return new IEnumerator((function(){enumerator=source.GetEnumerator()}),(function(){return!!enumerator.MoveNext()&&this.Yield(selector(enumerator.Current(),index++))}),(function(){Utils.Dispose(enumerator)}))}))},SelectMany:function(collectionSelector,resultSelector){var source=this;return collectionSelector=Utils.CreateLambda(collectionSelector),null==resultSelector&&(resultSelector=function(a,b){return b}),resultSelector=Utils.CreateLambda(resultSelector),new Enumerable((function(){var enumerator,middleEnumerator=void 0,index=0;return new IEnumerator((function(){enumerator=source.GetEnumerator()}),(function(){if(void 0===middleEnumerator&&!enumerator.MoveNext())return!1;do{if(null==middleEnumerator){var middleSeq=collectionSelector(enumerator.Current(),index++);middleEnumerator=Enumerable.From(middleSeq).GetEnumerator()}if(middleEnumerator.MoveNext())return this.Yield(resultSelector(enumerator.Current(),middleEnumerator.Current()));Utils.Dispose(middleEnumerator),middleEnumerator=null}while(enumerator.MoveNext());return!1}),(function(){try{Utils.Dispose(enumerator)}finally{Utils.Dispose(middleEnumerator)}}))}))},Where:function(predicate){predicate=Utils.CreateLambda(predicate);var source=this;return new Enumerable((function(){var enumerator,index=0;return new IEnumerator((function(){enumerator=source.GetEnumerator()}),(function(){for(;enumerator.MoveNext();)if(predicate(enumerator.Current(),index++))return this.Yield(enumerator.Current());return!1}),(function(){Utils.Dispose(enumerator)}))}))},OfType:function(type){var typeName;switch(type){case Number:typeName=Types.Number;break;case String:typeName=Types.String;break;case Boolean:typeName=Types.Boolean;break;case Function:typeName=Types.Function;break;default:typeName=null}return null===typeName?this.Where((function(x){return x instanceof type})):this.Where((function(x){return typeof x===typeName}))},Zip:function(second,selector){selector=Utils.CreateLambda(selector);var source=this;return new Enumerable((function(){var firstEnumerator,secondEnumerator,index=0;return new IEnumerator((function(){firstEnumerator=source.GetEnumerator(),secondEnumerator=Enumerable.From(second).GetEnumerator()}),(function(){return!(!firstEnumerator.MoveNext()||!secondEnumerator.MoveNext())&&this.Yield(selector(firstEnumerator.Current(),secondEnumerator.Current(),index++))}),(function(){try{Utils.Dispose(firstEnumerator)}finally{Utils.Dispose(secondEnumerator)}}))}))},Join:function(inner,outerKeySelector,innerKeySelector,resultSelector,compareSelector){outerKeySelector=Utils.CreateLambda(outerKeySelector),innerKeySelector=Utils.CreateLambda(innerKeySelector),resultSelector=Utils.CreateLambda(resultSelector),compareSelector=Utils.CreateLambda(compareSelector);var source=this;return new Enumerable((function(){var outerEnumerator,lookup,innerElements=null,innerCount=0;return new IEnumerator((function(){outerEnumerator=source.GetEnumerator(),lookup=Enumerable.From(inner).ToLookup(innerKeySelector,Functions.Identity,compareSelector)}),(function(){for(;;){if(null!=innerElements){var innerElement=innerElements[innerCount++];if(void 0!==innerElement)return this.Yield(resultSelector(outerEnumerator.Current(),innerElement));innerElement=null,innerCount=0}if(!outerEnumerator.MoveNext())return!1;var key=outerKeySelector(outerEnumerator.Current());innerElements=lookup.Get(key).ToArray()}}),(function(){Utils.Dispose(outerEnumerator)}))}))},GroupJoin:function(inner,outerKeySelector,innerKeySelector,resultSelector,compareSelector){outerKeySelector=Utils.CreateLambda(outerKeySelector),innerKeySelector=Utils.CreateLambda(innerKeySelector),resultSelector=Utils.CreateLambda(resultSelector),compareSelector=Utils.CreateLambda(compareSelector);var source=this;return new Enumerable((function(){var enumerator=source.GetEnumerator(),lookup=null;return new IEnumerator((function(){enumerator=source.GetEnumerator(),lookup=Enumerable.From(inner).ToLookup(innerKeySelector,Functions.Identity,compareSelector)}),(function(){if(enumerator.MoveNext()){var innerElement=lookup.Get(outerKeySelector(enumerator.Current()));return this.Yield(resultSelector(enumerator.Current(),innerElement))}return!1}),(function(){Utils.Dispose(enumerator)}))}))},All:function(predicate){predicate=Utils.CreateLambda(predicate);var result=!0;return this.ForEach((function(x){if(!predicate(x))return result=!1,!1})),result},Any:function(predicate){predicate=Utils.CreateLambda(predicate);var enumerator=this.GetEnumerator();try{if(0==arguments.length)return enumerator.MoveNext();for(;enumerator.MoveNext();)if(predicate(enumerator.Current()))return!0;return!1}finally{Utils.Dispose(enumerator)}},Concat:function(second){var source=this;return new Enumerable((function(){var firstEnumerator,secondEnumerator;return new IEnumerator((function(){firstEnumerator=source.GetEnumerator()}),(function(){if(null==secondEnumerator){if(firstEnumerator.MoveNext())return this.Yield(firstEnumerator.Current());secondEnumerator=Enumerable.From(second).GetEnumerator()}return!!secondEnumerator.MoveNext()&&this.Yield(secondEnumerator.Current())}),(function(){try{Utils.Dispose(firstEnumerator)}finally{Utils.Dispose(secondEnumerator)}}))}))},Insert:function(index,second){var source=this;return new Enumerable((function(){var firstEnumerator,secondEnumerator,count=0,isEnumerated=!1;return new IEnumerator((function(){firstEnumerator=source.GetEnumerator(),secondEnumerator=Enumerable.From(second).GetEnumerator()}),(function(){return count==index&&secondEnumerator.MoveNext()?(isEnumerated=!0,this.Yield(secondEnumerator.Current())):firstEnumerator.MoveNext()?(count++,this.Yield(firstEnumerator.Current())):!(isEnumerated||!secondEnumerator.MoveNext())&&this.Yield(secondEnumerator.Current())}),(function(){try{Utils.Dispose(firstEnumerator)}finally{Utils.Dispose(secondEnumerator)}}))}))},Alternate:function(value){return value=Enumerable.Return(value),this.SelectMany((function(elem){return Enumerable.Return(elem).Concat(value)})).TakeExceptLast()},Contains:function(value,compareSelector){compareSelector=Utils.CreateLambda(compareSelector);var enumerator=this.GetEnumerator();try{for(;enumerator.MoveNext();)if(compareSelector(enumerator.Current())===value)return!0;return!1}finally{Utils.Dispose(enumerator)}},DefaultIfEmpty:function(defaultValue){var source=this;return new Enumerable((function(){var enumerator,isFirst=!0;return new IEnumerator((function(){enumerator=source.GetEnumerator()}),(function(){return enumerator.MoveNext()?(isFirst=!1,this.Yield(enumerator.Current())):!!isFirst&&(isFirst=!1,this.Yield(defaultValue))}),(function(){Utils.Dispose(enumerator)}))}))},Distinct:function(compareSelector){return this.Except(Enumerable.Empty(),compareSelector)},Except:function(second,compareSelector){compareSelector=Utils.CreateLambda(compareSelector);var source=this;return new Enumerable((function(){var enumerator,keys;return new IEnumerator((function(){enumerator=source.GetEnumerator(),keys=new Dictionary(compareSelector),Enumerable.From(second).ForEach((function(key){keys.Add(key)}))}),(function(){for(;enumerator.MoveNext();){var current=enumerator.Current();if(!keys.Contains(current))return keys.Add(current),this.Yield(current)}return!1}),(function(){Utils.Dispose(enumerator)}))}))},Intersect:function(second,compareSelector){compareSelector=Utils.CreateLambda(compareSelector);var source=this;return new Enumerable((function(){var enumerator,keys,outs;return new IEnumerator((function(){enumerator=source.GetEnumerator(),keys=new Dictionary(compareSelector),Enumerable.From(second).ForEach((function(key){keys.Add(key)})),outs=new Dictionary(compareSelector)}),(function(){for(;enumerator.MoveNext();){var current=enumerator.Current();if(!outs.Contains(current)&&keys.Contains(current))return outs.Add(current),this.Yield(current)}return!1}),(function(){Utils.Dispose(enumerator)}))}))},SequenceEqual:function(second,compareSelector){compareSelector=Utils.CreateLambda(compareSelector);var firstEnumerator=this.GetEnumerator();try{var secondEnumerator=Enumerable.From(second).GetEnumerator();try{for(;firstEnumerator.MoveNext();)if(!secondEnumerator.MoveNext()||compareSelector(firstEnumerator.Current())!==compareSelector(secondEnumerator.Current()))return!1;return!secondEnumerator.MoveNext()}finally{Utils.Dispose(secondEnumerator)}}finally{Utils.Dispose(firstEnumerator)}},Union:function(second,compareSelector){compareSelector=Utils.CreateLambda(compareSelector);var source=this;return new Enumerable((function(){var firstEnumerator,secondEnumerator,keys;return new IEnumerator((function(){firstEnumerator=source.GetEnumerator(),keys=new Dictionary(compareSelector)}),(function(){var current;if(void 0===secondEnumerator){for(;firstEnumerator.MoveNext();)if(current=firstEnumerator.Current(),!keys.Contains(current))return keys.Add(current),this.Yield(current);secondEnumerator=Enumerable.From(second).GetEnumerator()}for(;secondEnumerator.MoveNext();)if(current=secondEnumerator.Current(),!keys.Contains(current))return keys.Add(current),this.Yield(current);return!1}),(function(){try{Utils.Dispose(firstEnumerator)}finally{Utils.Dispose(secondEnumerator)}}))}))},OrderBy:function(keySelector){return new OrderedEnumerable(this,keySelector,!1)},OrderByDescending:function(keySelector){return new OrderedEnumerable(this,keySelector,!0)},Reverse:function(){var source=this;return new Enumerable((function(){var buffer,index;return new IEnumerator((function(){buffer=source.ToArray(),index=buffer.length}),(function(){return index>0&&this.Yield(buffer[--index])}),Functions.Blank)}))},Shuffle:function(){var source=this;return new Enumerable((function(){var buffer;return new IEnumerator((function(){buffer=source.ToArray()}),(function(){if(buffer.length>0){var i=Math.floor(Math.random()*buffer.length);return this.Yield(buffer.splice(i,1)[0])}return!1}),Functions.Blank)}))},GroupBy:function(keySelector,elementSelector,resultSelector,compareSelector){var source=this;return keySelector=Utils.CreateLambda(keySelector),elementSelector=Utils.CreateLambda(elementSelector),null!=resultSelector&&(resultSelector=Utils.CreateLambda(resultSelector)),compareSelector=Utils.CreateLambda(compareSelector),new Enumerable((function(){var enumerator;return new IEnumerator((function(){enumerator=source.ToLookup(keySelector,elementSelector,compareSelector).ToEnumerable().GetEnumerator()}),(function(){for(;enumerator.MoveNext();)return null==resultSelector?this.Yield(enumerator.Current()):this.Yield(resultSelector(enumerator.Current().Key(),enumerator.Current()));return!1}),(function(){Utils.Dispose(enumerator)}))}))},PartitionBy:function(keySelector,elementSelector,resultSelector,compareSelector){var source=this,hasResultSelector;return keySelector=Utils.CreateLambda(keySelector),elementSelector=Utils.CreateLambda(elementSelector),compareSelector=Utils.CreateLambda(compareSelector),null==resultSelector?(hasResultSelector=!1,resultSelector=function(key,group){return new Grouping(key,group)}):(hasResultSelector=!0,resultSelector=Utils.CreateLambda(resultSelector)),new Enumerable((function(){var enumerator,key,compareKey,group=[];return new IEnumerator((function(){(enumerator=source.GetEnumerator()).MoveNext()&&(key=keySelector(enumerator.Current()),compareKey=compareSelector(key),group.push(elementSelector(enumerator.Current())))}),(function(){for(var hasNext;1==(hasNext=enumerator.MoveNext())&&compareKey===compareSelector(keySelector(enumerator.Current()));)group.push(elementSelector(enumerator.Current()));if(group.length>0){var result=resultSelector(key,hasResultSelector?Enumerable.From(group):group);return hasNext?(key=keySelector(enumerator.Current()),compareKey=compareSelector(key),group=[elementSelector(enumerator.Current())]):group=[],this.Yield(result)}return!1}),(function(){Utils.Dispose(enumerator)}))}))},BufferWithCount:function(count){var source=this;return new Enumerable((function(){var enumerator;return new IEnumerator((function(){enumerator=source.GetEnumerator()}),(function(){for(var array=[],index=0;enumerator.MoveNext();)if(array.push(enumerator.Current()),++index>=count)return this.Yield(array);return array.length>0&&this.Yield(array)}),(function(){Utils.Dispose(enumerator)}))}))},Aggregate:function(seed,func,resultSelector){return this.Scan(seed,func,resultSelector).Last()},Average:function(selector){selector=Utils.CreateLambda(selector);var sum=0,count=0;return this.ForEach((function(x){sum+=selector(x),++count})),sum/count},Count:function(predicate){predicate=null==predicate?Functions.True:Utils.CreateLambda(predicate);var count=0;return this.ForEach((function(x,i){predicate(x,i)&&++count})),count},Max:function(selector){return null==selector&&(selector=Functions.Identity),this.Select(selector).Aggregate((function(a,b){return a>b?a:b}))},Min:function(selector){return null==selector&&(selector=Functions.Identity),this.Select(selector).Aggregate((function(a,b){return a<b?a:b}))},MaxBy:function(keySelector){return keySelector=Utils.CreateLambda(keySelector),this.Aggregate((function(a,b){return keySelector(a)>keySelector(b)?a:b}))},MinBy:function(keySelector){return keySelector=Utils.CreateLambda(keySelector),this.Aggregate((function(a,b){return keySelector(a)<keySelector(b)?a:b}))},Sum:function(selector){return null==selector&&(selector=Functions.Identity),this.Select(selector).Aggregate(0,(function(a,b){return a+b}))},ElementAt:function(index){var value,found=!1;if(this.ForEach((function(x,i){if(i==index)return value=x,found=!0,!1})),!found)throw new Error("index is less than 0 or greater than or equal to the number of elements in source.");return value},ElementAtOrDefault:function(index,defaultValue){var value,found=!1;return this.ForEach((function(x,i){if(i==index)return value=x,found=!0,!1})),found?value:defaultValue},First:function(predicate){if(null!=predicate)return this.Where(predicate).First();var value,found=!1;if(this.ForEach((function(x){return value=x,found=!0,!1})),!found)throw new Error("First:No element satisfies the condition.");return value},FirstOrDefault:function(defaultValue,predicate){if(null!=predicate)return this.Where(predicate).FirstOrDefault(defaultValue);var value,found=!1;return this.ForEach((function(x){return value=x,found=!0,!1})),found?value:defaultValue},Last:function(predicate){if(null!=predicate)return this.Where(predicate).Last();var value,found=!1;if(this.ForEach((function(x){found=!0,value=x})),!found)throw new Error("Last:No element satisfies the condition.");return value},LastOrDefault:function(defaultValue,predicate){if(null!=predicate)return this.Where(predicate).LastOrDefault(defaultValue);var value,found=!1;return this.ForEach((function(x){found=!0,value=x})),found?value:defaultValue},Single:function(predicate){if(null!=predicate)return this.Where(predicate).Single();var value,found=!1;if(this.ForEach((function(x){if(found)throw new Error("Single:sequence contains more than one element.");found=!0,value=x})),!found)throw new Error("Single:No element satisfies the condition.");return value},SingleOrDefault:function(defaultValue,predicate){if(null!=predicate)return this.Where(predicate).SingleOrDefault(defaultValue);var value,found=!1;return this.ForEach((function(x){if(found)throw new Error("Single:sequence contains more than one element.");found=!0,value=x})),found?value:defaultValue},Skip:function(count){var source=this;return new Enumerable((function(){var enumerator,index=0;return new IEnumerator((function(){for(enumerator=source.GetEnumerator();index++<count&&enumerator.MoveNext(););}),(function(){return!!enumerator.MoveNext()&&this.Yield(enumerator.Current())}),(function(){Utils.Dispose(enumerator)}))}))},SkipWhile:function(predicate){predicate=Utils.CreateLambda(predicate);var source=this;return new Enumerable((function(){var enumerator,index=0,isSkipEnd=!1;return new IEnumerator((function(){enumerator=source.GetEnumerator()}),(function(){for(;!isSkipEnd;){if(!enumerator.MoveNext())return!1;if(!predicate(enumerator.Current(),index++))return isSkipEnd=!0,this.Yield(enumerator.Current())}return!!enumerator.MoveNext()&&this.Yield(enumerator.Current())}),(function(){Utils.Dispose(enumerator)}))}))},Take:function(count){var source=this;return new Enumerable((function(){var enumerator,index=0;return new IEnumerator((function(){enumerator=source.GetEnumerator()}),(function(){return!!(index++<count&&enumerator.MoveNext())&&this.Yield(enumerator.Current())}),(function(){Utils.Dispose(enumerator)}))}))},TakeWhile:function(predicate){predicate=Utils.CreateLambda(predicate);var source=this;return new Enumerable((function(){var enumerator,index=0;return new IEnumerator((function(){enumerator=source.GetEnumerator()}),(function(){return!(!enumerator.MoveNext()||!predicate(enumerator.Current(),index++))&&this.Yield(enumerator.Current())}),(function(){Utils.Dispose(enumerator)}))}))},TakeExceptLast:function(count){null==count&&(count=1);var source=this;return new Enumerable((function(){if(count<=0)return source.GetEnumerator();var enumerator,q=[];return new IEnumerator((function(){enumerator=source.GetEnumerator()}),(function(){for(;enumerator.MoveNext();){if(q.length==count)return q.push(enumerator.Current()),this.Yield(q.shift());q.push(enumerator.Current())}return!1}),(function(){Utils.Dispose(enumerator)}))}))},TakeFromLast:function(count){if(count<=0||null==count)return Enumerable.Empty();var source=this;return new Enumerable((function(){var sourceEnumerator,enumerator,q=[];return new IEnumerator((function(){sourceEnumerator=source.GetEnumerator()}),(function(){for(;sourceEnumerator.MoveNext();)q.length==count&&q.shift(),q.push(sourceEnumerator.Current());return null==enumerator&&(enumerator=Enumerable.From(q).GetEnumerator()),!!enumerator.MoveNext()&&this.Yield(enumerator.Current())}),(function(){Utils.Dispose(enumerator)}))}))},IndexOf:function(item){var found=null;return this.ForEach((function(x,i){if(x===item)return found=i,!0})),null!==found?found:-1},LastIndexOf:function(item){var result=-1;return this.ForEach((function(x,i){x===item&&(result=i)})),result},ToArray:function(){var array=[];return this.ForEach((function(x){array.push(x)})),array},ToLookup:function(keySelector,elementSelector,compareSelector){keySelector=Utils.CreateLambda(keySelector),elementSelector=Utils.CreateLambda(elementSelector),compareSelector=Utils.CreateLambda(compareSelector);var dict=new Dictionary(compareSelector);return this.ForEach((function(x){var key=keySelector(x),element=elementSelector(x),array=dict.Get(key);void 0!==array?array.push(element):dict.Add(key,[element])})),new Lookup(dict)},ToObject:function(keySelector,elementSelector){keySelector=Utils.CreateLambda(keySelector),elementSelector=Utils.CreateLambda(elementSelector);var obj={};return this.ForEach((function(x){obj[keySelector(x)]=elementSelector(x)})),obj},ToDictionary:function(keySelector,elementSelector,compareSelector){keySelector=Utils.CreateLambda(keySelector),elementSelector=Utils.CreateLambda(elementSelector),compareSelector=Utils.CreateLambda(compareSelector);var dict=new Dictionary(compareSelector);return this.ForEach((function(x){dict.Add(keySelector(x),elementSelector(x))})),dict},ToJSON:function(replacer,space){return JSON.stringify(this.ToArray(),replacer,space)},ToString:function(separator,selector){return null==separator&&(separator=""),null==selector&&(selector=Functions.Identity),this.Select(selector).ToArray().join(separator)},Do:function(action){var source=this;return action=Utils.CreateLambda(action),new Enumerable((function(){var enumerator,index=0;return new IEnumerator((function(){enumerator=source.GetEnumerator()}),(function(){return!!enumerator.MoveNext()&&(action(enumerator.Current(),index++),this.Yield(enumerator.Current()))}),(function(){Utils.Dispose(enumerator)}))}))},ForEach:function(action){action=Utils.CreateLambda(action);var index=0,enumerator=this.GetEnumerator();try{for(;enumerator.MoveNext()&&!1!==action(enumerator.Current(),index++););}finally{Utils.Dispose(enumerator)}},Write:function(separator,selector){null==separator&&(separator=""),selector=Utils.CreateLambda(selector);var isFirst=!0;this.ForEach((function(item){isFirst?isFirst=!1:document.write(separator),document.write(selector(item))}))},WriteLine:function(selector){selector=Utils.CreateLambda(selector),this.ForEach((function(item){document.write(selector(item)),document.write("<br />")}))},Force:function(){var enumerator=this.GetEnumerator();try{for(;enumerator.MoveNext(););}finally{Utils.Dispose(enumerator)}},Let:function(func){func=Utils.CreateLambda(func);var source=this;return new Enumerable((function(){var enumerator;return new IEnumerator((function(){enumerator=Enumerable.From(func(source)).GetEnumerator()}),(function(){return!!enumerator.MoveNext()&&this.Yield(enumerator.Current())}),(function(){Utils.Dispose(enumerator)}))}))},Share:function(){var source=this,sharedEnumerator;return new Enumerable((function(){return new IEnumerator((function(){null==sharedEnumerator&&(sharedEnumerator=source.GetEnumerator())}),(function(){return!!sharedEnumerator.MoveNext()&&this.Yield(sharedEnumerator.Current())}),Functions.Blank)}))},MemoizeAll:function(){var source=this,cache,enumerator;return new Enumerable((function(){var index=-1;return new IEnumerator((function(){null==enumerator&&(enumerator=source.GetEnumerator(),cache=[])}),(function(){return index++,cache.length<=index?!!enumerator.MoveNext()&&this.Yield(cache[index]=enumerator.Current()):this.Yield(cache[index])}),Functions.Blank)}))},Catch:function(handler){handler=Utils.CreateLambda(handler);var source=this;return new Enumerable((function(){var enumerator;return new IEnumerator((function(){enumerator=source.GetEnumerator()}),(function(){try{return!!enumerator.MoveNext()&&this.Yield(enumerator.Current())}catch(e){return handler(e),!1}}),(function(){Utils.Dispose(enumerator)}))}))},Finally:function(finallyAction){finallyAction=Utils.CreateLambda(finallyAction);var source=this;return new Enumerable((function(){var enumerator;return new IEnumerator((function(){enumerator=source.GetEnumerator()}),(function(){return!!enumerator.MoveNext()&&this.Yield(enumerator.Current())}),(function(){try{Utils.Dispose(enumerator)}finally{finallyAction()}}))}))},Trace:function(message,selector){return null==message&&(message="Trace"),selector=Utils.CreateLambda(selector),this.Do((function(item){console.log(message,":",selector(item))}))}};var Functions={Identity:function(x){return x},True:function(){return!0},Blank:function(){}},Types={Boolean:typeof!0,Number:"number",String:"string",Object:typeof{},Undefined:"undefined",Function:"function"},Utils={CreateLambda:function(expression){if(null==expression)return Functions.Identity;if(typeof expression==Types.String){if(""==expression)return Functions.Identity;if(-1==expression.indexOf("=>"))return new Function("$,$$,$$$,$$$$","return "+expression);var expr=expression.match(/^[(\s]*([^()]*?)[)\s]*=>(.*)/);return new Function(expr[1],"return "+expr[2])}return expression},IsIEnumerable:function(obj){if(typeof Enumerator!=Types.Undefined)try{return new Enumerator(obj),!0}catch(e){}return!1},Compare:function(a,b){return a===b?0:a>b?1:-1},Dispose:function(obj){null!=obj&&obj.Dispose()}},State_Before=0,State_Running=1,State_After=2,IEnumerator=function(initialize,tryGetNext,dispose){var yielder=new Yielder,state=State_Before;this.Current=yielder.Current,this.MoveNext=function(){try{switch(state){case State_Before:state=State_Running,initialize();case State_Running:return!!tryGetNext.apply(yielder)||(this.Dispose(),!1);case State_After:return!1}}catch(e){throw this.Dispose(),e}},this.Dispose=function(){if(state==State_Running)try{dispose()}finally{state=State_After}}},Yielder=function(){var current=null;this.Current=function(){return current},this.Yield=function(value){return current=value,!0}},OrderedEnumerable=function(source,keySelector,descending,parent){this.source=source,this.keySelector=Utils.CreateLambda(keySelector),this.descending=descending,this.parent=parent};OrderedEnumerable.prototype=new Enumerable,OrderedEnumerable.prototype.CreateOrderedEnumerable=function(keySelector,descending){return new OrderedEnumerable(this.source,keySelector,descending,this)},OrderedEnumerable.prototype.ThenBy=function(keySelector){return this.CreateOrderedEnumerable(keySelector,!1)},OrderedEnumerable.prototype.ThenByDescending=function(keySelector){return this.CreateOrderedEnumerable(keySelector,!0)},OrderedEnumerable.prototype.GetEnumerator=function(){var self=this,buffer,indexes,index=0;return new IEnumerator((function(){buffer=[],indexes=[],self.source.ForEach((function(item,index){buffer.push(item),indexes.push(index)}));var sortContext=SortContext.Create(self,null);sortContext.GenerateKeys(buffer),indexes.sort((function(a,b){return sortContext.Compare(a,b)}))}),(function(){return index<indexes.length&&this.Yield(buffer[indexes[index++]])}),Functions.Blank)};var SortContext=function(keySelector,descending,child){this.keySelector=keySelector,this.descending=descending,this.child=child,this.keys=null};SortContext.Create=function(orderedEnumerable,currentContext){var context=new SortContext(orderedEnumerable.keySelector,orderedEnumerable.descending,currentContext);return null!=orderedEnumerable.parent?SortContext.Create(orderedEnumerable.parent,context):context},SortContext.prototype.GenerateKeys=function(source){for(var len=source.length,keySelector=this.keySelector,keys=new Array(len),i=0;i<len;i++)keys[i]=keySelector(source[i]);this.keys=keys,null!=this.child&&this.child.GenerateKeys(source)},SortContext.prototype.Compare=function(index1,index2){var comparison=Utils.Compare(this.keys[index1],this.keys[index2]);if(0==comparison){if(null!=this.child)return this.child.Compare(index1,index2);comparison=Utils.Compare(index1,index2)}return this.descending?-comparison:comparison};var ArrayEnumerable=function(source){this.source=source};ArrayEnumerable.prototype=new Enumerable,ArrayEnumerable.prototype.Any=function(predicate){return null==predicate?this.source.length>0:Enumerable.prototype.Any.apply(this,arguments)},ArrayEnumerable.prototype.Count=function(predicate){return null==predicate?this.source.length:Enumerable.prototype.Count.apply(this,arguments)},ArrayEnumerable.prototype.ElementAt=function(index){return 0<=index&&index<this.source.length?this.source[index]:Enumerable.prototype.ElementAt.apply(this,arguments)},ArrayEnumerable.prototype.ElementAtOrDefault=function(index,defaultValue){return 0<=index&&index<this.source.length?this.source[index]:defaultValue},ArrayEnumerable.prototype.First=function(predicate){return null==predicate&&this.source.length>0?this.source[0]:Enumerable.prototype.First.apply(this,arguments)},ArrayEnumerable.prototype.FirstOrDefault=function(defaultValue,predicate){return null!=predicate?Enumerable.prototype.FirstOrDefault.apply(this,arguments):this.source.length>0?this.source[0]:defaultValue},ArrayEnumerable.prototype.Last=function(predicate){return null==predicate&&this.source.length>0?this.source[this.source.length-1]:Enumerable.prototype.Last.apply(this,arguments)},ArrayEnumerable.prototype.LastOrDefault=function(defaultValue,predicate){return null!=predicate?Enumerable.prototype.LastOrDefault.apply(this,arguments):this.source.length>0?this.source[this.source.length-1]:defaultValue},ArrayEnumerable.prototype.Skip=function(count){var source=this.source;return new Enumerable((function(){var index;return new IEnumerator((function(){index=count<0?0:count}),(function(){return index<source.length&&this.Yield(source[index++])}),Functions.Blank)}))},ArrayEnumerable.prototype.TakeExceptLast=function(count){return null==count&&(count=1),this.Take(this.source.length-count)},ArrayEnumerable.prototype.TakeFromLast=function(count){return this.Skip(this.source.length-count)},ArrayEnumerable.prototype.Reverse=function(){var source=this.source;return new Enumerable((function(){var index;return new IEnumerator((function(){index=source.length}),(function(){return index>0&&this.Yield(source[--index])}),Functions.Blank)}))},ArrayEnumerable.prototype.SequenceEqual=function(second,compareSelector){return(!(second instanceof ArrayEnumerable||second instanceof Array)||null!=compareSelector||Enumerable.From(second).Count()==this.Count())&&Enumerable.prototype.SequenceEqual.apply(this,arguments)},ArrayEnumerable.prototype.ToString=function(separator,selector){return null==selector&&this.source instanceof Array?(null==separator&&(separator=""),this.source.join(separator)):Enumerable.prototype.ToString.apply(this,arguments)},ArrayEnumerable.prototype.GetEnumerator=function(){var source=this.source,index=0;return new IEnumerator(Functions.Blank,(function(){return index<source.length&&this.Yield(source[index++])}),Functions.Blank)};var Dictionary=function(){var HasOwnProperty=function(target,key){return Object.prototype.hasOwnProperty.call(target,key)},ComputeHashCode=function(obj){return null===obj?"null":void 0===obj?"undefined":typeof obj.toString===Types.Function?obj.toString():Object.prototype.toString.call(obj)},HashEntry=function(key,value){this.Key=key,this.Value=value,this.Prev=null,this.Next=null},EntryList=function(){this.First=null,this.Last=null};EntryList.prototype={AddLast:function(entry){null!=this.Last?(this.Last.Next=entry,entry.Prev=this.Last,this.Last=entry):this.First=this.Last=entry},Replace:function(entry,newEntry){null!=entry.Prev?(entry.Prev.Next=newEntry,newEntry.Prev=entry.Prev):this.First=newEntry,null!=entry.Next?(entry.Next.Prev=newEntry,newEntry.Next=entry.Next):this.Last=newEntry},Remove:function(entry){null!=entry.Prev?entry.Prev.Next=entry.Next:this.First=entry.Next,null!=entry.Next?entry.Next.Prev=entry.Prev:this.Last=entry.Prev}};var Dictionary=function(compareSelector){this.count=0,this.entryList=new EntryList,this.buckets={},this.compareSelector=null==compareSelector?Functions.Identity:compareSelector};return Dictionary.prototype={Add:function(key,value){var compareKey=this.compareSelector(key),hash=ComputeHashCode(compareKey),entry=new HashEntry(key,value);if(HasOwnProperty(this.buckets,hash)){for(var array=this.buckets[hash],i=0;i<array.length;i++)if(this.compareSelector(array[i].Key)===compareKey)return this.entryList.Replace(array[i],entry),void(array[i]=entry);array.push(entry)}else this.buckets[hash]=[entry];this.count++,this.entryList.AddLast(entry)},Get:function(key){var compareKey=this.compareSelector(key),hash=ComputeHashCode(compareKey);if(HasOwnProperty(this.buckets,hash))for(var array=this.buckets[hash],i=0;i<array.length;i++){var entry=array[i];if(this.compareSelector(entry.Key)===compareKey)return entry.Value}},Set:function(key,value){var compareKey=this.compareSelector(key),hash=ComputeHashCode(compareKey);if(HasOwnProperty(this.buckets,hash))for(var array=this.buckets[hash],i=0;i<array.length;i++)if(this.compareSelector(array[i].Key)===compareKey){var newEntry=new HashEntry(key,value);return this.entryList.Replace(array[i],newEntry),array[i]=newEntry,!0}return!1},Contains:function(key){var compareKey=this.compareSelector(key),hash=ComputeHashCode(compareKey);if(!HasOwnProperty(this.buckets,hash))return!1;for(var array=this.buckets[hash],i=0;i<array.length;i++)if(this.compareSelector(array[i].Key)===compareKey)return!0;return!1},Clear:function(){this.count=0,this.buckets={},this.entryList=new EntryList},Remove:function(key){var compareKey=this.compareSelector(key),hash=ComputeHashCode(compareKey);if(HasOwnProperty(this.buckets,hash))for(var array=this.buckets[hash],i=0;i<array.length;i++)if(this.compareSelector(array[i].Key)===compareKey)return this.entryList.Remove(array[i]),array.splice(i,1),0==array.length&&delete this.buckets[hash],void this.count--},Count:function(){return this.count},ToEnumerable:function(){var self=this;return new Enumerable((function(){var currentEntry;return new IEnumerator((function(){currentEntry=self.entryList.First}),(function(){if(null!=currentEntry){var result={Key:currentEntry.Key,Value:currentEntry.Value};return currentEntry=currentEntry.Next,this.Yield(result)}return!1}),Functions.Blank)}))}},Dictionary}(),Lookup=function(dictionary){this.Count=function(){return dictionary.Count()},this.Get=function(key){return Enumerable.From(dictionary.Get(key))},this.Contains=function(key){return dictionary.Contains(key)},this.ToEnumerable=function(){return dictionary.ToEnumerable().Select((function(kvp){return new Grouping(kvp.Key,kvp.Value)}))}},Grouping=function(key,elements){this.Key=function(){return key},ArrayEnumerable.call(this,elements)};return Grouping.prototype=new ArrayEnumerable,Enumerable}();